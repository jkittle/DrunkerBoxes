// WEMOS D1 MINI VERSION WITH BUILT IN LED USED FOR BEACON

#include <SPI.h>
#include <Wire.h>
#include <ESP8266WiFi.h>
#include <ESP8266HTTPClient.h>

void setup()   {
  pinMode(LED_BUILTIN, OUTPUT);
  digitalWrite(LED_BUILTIN, HIGH);
  String Message; 
  Serial.begin(9600);
  Serial.println();
  WiFi.begin("myssid", "password");
  delay(2000);
  Serial.print("Connecting");
  while (WiFi.status() != WL_CONNECTED)
  {
    delay(500);
    Serial.print(".");
  }
  Serial.println();
  Serial.print("Connected, IP address: ");
  Serial.println(WiFi.localIP());
}

void loop() {
delay(1000);
if (WiFi.status() == WL_CONNECTED) { //Check WiFi connection status
  HTTPClient http;  //Declare an object of class HTTPClient
    http.begin("http://drunkerbot.hardwareflare.com/api/status/state");  //Specify request destination
    int httpCode = http.GET();                                      //Send the request
    if (httpCode > 0) { //Check the returning code
      String payload = http.getString();   //Get the request response payload
      Serial.println(payload);             //Print the response payload 
      if (payload = "true") {
        digitalWrite(LED_BUILTIN, LOW); }  // The Built In LED on the D1 Mini is active LOW not HIGH
      else {
        digitalWrite(LED_BUILTIN, HIGH); }
   http.end();   //Close connection
 delay(5000);    //Send a request every 30 seconds
    }
    else
    delay(1000);
 }
}
